import streamlit.components.v1

from htbuilder import H, HtmlElement, styles
from htbuilder.units import unit

# Only works in 3.7+: from htbuilder import div, span
div = H.div
span = H.span

# Only works in 3.7+: from htbuilder.units import px, rem, em
px = unit.px
rem = unit.rem
em = unit.em


def annotation(body, label="", background="#ddd", color="#333", **style):

    if "font_family" not in style:
        style["font_family"] = "sans-serif"

    return span(
        style=styles(
            background=background,
            border_radius=rem(0.13),
            color=color,
            padding=(rem(0.1), rem(0.17)),
            display="inline-flex",
            justify_content="center",
            align_items="center",
            **style,
        )
    )(
        body,
        span(
            style=styles(
                color=color,
                font_size=em(0.67),
                opacity=0.5,
                padding_left=rem(0.1),
                text_transform="uppercase",
                margin_bottom=px(-2),
            )
        )(label)
    )


def annotated_text_file(*args, **st_html_kwargs):

    out = div(style=styles(
        font_family="sans-serif",
        line_height="0.9",
        font_size=px(16),
    ))

    for arg in args:
        if isinstance(arg, str):
            out(arg)

        elif isinstance(arg, HtmlElement):
            out(arg)

        elif isinstance(arg, tuple):
            out(annotation(*arg))

        else:
            raise Exception("Oh noes!")

    streamlit.components.v1.html(str(out),height=50, **st_html_kwargs)

def annotated_text(*args, **st_html_kwargs):

    out = div(style=styles(
        font_family="sans-serif",
        line_height="0.9",
        font_size=px(16),
    ))

    for arg in args:
        if isinstance(arg, str):
            out(arg)

        elif isinstance(arg, HtmlElement):
            out(arg)

        elif isinstance(arg, tuple):
            out(annotation(*arg))

        else:
            raise Exception("Oh noes!")

    streamlit.components.v1.html(str(out),height=250, **st_html_kwargs)